<template>
  <div class="max-w-6xl mx-auto p-6 space-y-6">

    <h1 class="text-2xl font-bold mb-4">‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢</h1>

    <div ref="pdfArea">
      <!-- 1. ‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ -->
      <section class="card">
        <label class="label">1) ‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢)</label>
        <input v-model="form.titleTH" class="input" />

        <label class="label mt-2">‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©)</label>
        <input v-model="form.titleEN" class="input" />
      </section>

      <!-- 2. ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ó‡∏∏‡∏ô -->
      <section class="card">
        <label class="label">2) ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ó‡∏∏‡∏ô</label>
        <select v-model="form.budgetType" class="input">
          <option disabled value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ó‡∏∏‡∏ô</option>
          <option v-for="b in budgetTypes" :key="b">{{ b }}</option>
        </select>
      </section>

      <!-- 3. ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πà‡∏ß‡∏°‡∏°‡∏∑‡∏≠ -->
      <section class="card">
        <label class="label">3) ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πà‡∏ß‡∏°‡∏°‡∏∑‡∏≠‡∏Å‡∏±‡∏ö‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å</label>
        <select v-model="form.cooperation" class="input">
          <option>‡πÑ‡∏°‡πà‡∏°‡∏µ</option>
          <option>‡∏°‡∏µ</option>
        </select>

        <input v-if="form.cooperation === '‡∏°‡∏µ'" v-model="form.cooperationDetail" class="input mt-2"
          placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î" />
      </section>

      <!-- 4. ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢ -->
      <div class="card">
        <h3 class="title">4) ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢</h3>


        <select v-model="form.researchType" class="select">
          <option disabled value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
          <option value="Science and Technology">
            ‡∏î‡πâ‡∏≤‡∏ô‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ / Science and Technology
          </option>
          <option value="Health Science">
            ‡∏î‡πâ‡∏≤‡∏ô‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û / Health Science
          </option>
          <option value="Social Science and Humanities">
            ‡∏î‡πâ‡∏≤‡∏ô‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå / Social Science and Humanities
          </option>
        </select>
      </div>


      <!-- 5-11 text editor -->
      <section v-for="(field, i) in textFields" :key="i" class="card">
        <label class="label">{{ field.label }}</label>
        <textarea v-model="form[field.model]" class="textarea"></textarea>
      </section>

      <!-- 12. ‡πÅ‡∏ú‡∏ô‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô -->
      <section class="card">
        <ResearchSection12 />
      </section>


      <!-- 13 -->
      <section class="card">
        <label class="label">13) ‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</label>
        <textarea v-model="form.progressReport" class="textarea"></textarea>
      </section>

      <!-- 14 -->
      <section class="card">
        <label class="label">14) ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</label>
        <div v-for="(opt, i) in resultOptions" :key="i">
          <label>
            <input type="checkbox" v-model="form.expectedResults" :value="opt" />
            {{ opt }}
          </label>
        </div>
      </section>

      <!-- 15 -->
      <section class="card">
        <label class="label">15) ‡∏Å‡∏≤‡∏£‡∏ö‡∏π‡∏£‡∏ì‡∏≤‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢</label>
        <textarea v-model="form.integration" class="textarea"></textarea>
      </section>

      <!-- 16 -->
      <section class="card">
        <label class="label">16) ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡∏ó‡∏≠‡∏î‡∏™‡∏π‡πà‡∏™‡∏±‡∏á‡∏Ñ‡∏°</label>
        <div>
          <label><input type="radio" value="‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏≤‡∏ï‡∏¥" v-model="form.transferLevel" /> ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏≤‡∏ï‡∏¥</label>
        </div>
        <div>
          <label><input type="radio" value="‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏∏‡∏°‡∏ä‡∏ô" v-model="form.transferLevel" /> ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏∏‡∏°‡∏ä‡∏ô</label>
        </div>
        <div>
          <label><input type="radio" value="‡πÑ‡∏°‡πà‡∏°‡∏µ" v-model="form.transferLevel" /> ‡πÑ‡∏°‡πà‡∏°‡∏µ</label>
        </div>
      </section>

      <!-- 17 ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì (‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏¢‡∏≠‡∏î) -->
      <section class="card">
        <BudgetSection v-model="form.budgets" />
      </section>

      <!-- 18 ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏¢‡∏ò‡∏£‡∏£‡∏° -->
      <section class="card">
        <label class="label">18) ‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢</label>
        <label>
          <input type="checkbox" v-model="form.ethics.human" />
          ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡πÉ‡∏ô‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå
        </label>
        <label>
          <input type="checkbox" v-model="form.ethics.animal" />
          ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏™‡∏±‡∏ï‡∏ß‡πå‡∏ó‡∏î‡∏•‡∏≠‡∏á
        </label>
      </section>

      <!-- 19 -->
      <section class="card">
        <label class="label">19) ‡∏Ñ‡∏≥‡∏ä‡∏µ‡πâ‡πÅ‡∏à‡∏á‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</label>
        <textarea v-model="form.remark" class="textarea"></textarea>
      </section>
    </div>
    <button class="button" @click="exportPDF">
      Export PDF
    </button>

    <button @click="submit" class="bg-blue-600 text-white px-6 py-2 rounded">
      ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    </button>

  </div>
</template>

<script>
import BudgetSection from "@/components/BudgetSection.vue";
import ResearchSection12 from "@/components/Section12.vue";
import html2pdf from "html2pdf.js";

export default {
  name: "ResearchForm",
  components: {
    BudgetSection,
    ResearchSection12
  },
  data() {
    return {
      monthCount: 6,
      activities: [
        this.newActivity()
      ],
      budgetTypes: [
        "‡∏ó‡∏∏‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ",
        "‡∏ó‡∏∏‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏à‡∏±‡∏¢",
        "‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏¢‡∏≠‡∏î‡∏≠‡∏∏‡∏ï‡∏™‡∏≤‡∏´‡∏Å‡∏£‡∏£‡∏°"
      ],
      resultOptions: [
        "‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£",
        "‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏ö‡∏±‡∏ï‡∏£",
        "‡∏ï‡πâ‡∏ô‡πÅ‡∏ö‡∏ö",
        "‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡∏ó‡∏≠‡∏î‡∏™‡∏±‡∏á‡∏Ñ‡∏°"
      ],
      textFields: [
        { label: "5) ‡∏Ñ‡∏≥‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (Keywords)", model: "keywords" },
        { label: "6) ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î", model: "importance" },
        { label: "7) ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå", model: "objective" },
        { label: "8) ‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏ß‡∏£‡∏£‡∏ì‡∏Å‡∏£‡∏£‡∏°", model: "literature" },
        { label: "9) ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á", model: "reference" },
        { label: "10) ‡∏ß‡∏¥‡∏ò‡∏µ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢", model: "methodology" },
        { label: "11) ‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢", model: "scope" }
      ],
      form: {
        titleTH: "",
        titleEN: "",
        budgetType: "",
        budgets: [],
        cooperation: "‡πÑ‡∏°‡πà‡∏°‡∏µ",
        cooperationDetail: "",
        researchType: "",
        keywords: "",
        importance: "",
        objective: "",
        literature: "",
        reference: "",
        methodology: "",
        scope: "",
        duration: "",
        progressReport: "",
        expectedResults: [],
        integration: "",
        transferLevel: "",
        budgetSummary: "",
        ethics: {
          human: false,
          animal: false
        },
        remark: ""
      }
    }
  },
  methods: {
    submit() {
      console.log("FORM DATA:", this.form)
      alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ (‡∏î‡∏π console)")
    },
    exportPDF() {
      const element = this.$refs.pdfArea;

      const opt = {
        margin: 10,
        filename: "research-form.pdf",
        image: { type: "jpeg", quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: "mm", format: "a4", orientation: "portrait" }
      };

      html2pdf().set(opt).from(element).save();
    },
    setMonths(n) {
      this.monthCount = n

      this.activities.forEach(a => {
        a.months = Array(n).fill(false)
      })
    },

    newActivity() {
      return {
        name: "",
        owner: "",
        months: Array(this.monthCount).fill(false)
      }
    },

    addActivity() {
      this.activities.push(this.newActivity())
    },

    toggleMonth(row, month) {
      this.activities[row].months[month] =
        !this.activities[row].months[month]
    },
  }
}
</script>

<style scoped>
.card {
  background: #ffffff;
  border: 1px solid #e5e5e5;
  border-radius: 6px;
  padding: 20px;
  margin-bottom: 20px;
}

.title {
  font-size: 18px;
  font-weight: 600;
  margin-bottom: 12px;
  color: #222;
}

.label {
  display: block;
  font-size: 14px;
  font-weight: 500;
  margin-bottom: 6px;
  color: #333;
}

.input,
.textarea,
.select {
  width: 100%;
  border: 1px solid #dcdcdc;
  border-radius: 4px;
  padding: 10px;
  font-size: 14px;
  background: #fafafa;
  transition: border 0.2s ease;
}

.input:focus,
.textarea:focus,
.select:focus {
  outline: none;
  border-color: #666;
  background: #ffffff;
}

.textarea {
  min-height: 120px;
  resize: vertical;
}

.row {
  margin-bottom: 14px;
}

.button {
  background: #222;
  color: #fff;
  padding: 10px 18px;
  border-radius: 4px;
  border: none;
  font-size: 14px;
  cursor: pointer;
  transition: opacity 0.2s ease;
}

.button:hover {
  opacity: 0.85;
}

@media print {
  .card {
    page-break-inside: avoid;
  }
}

.timeline-wrapper {
  display: flex;
  border: 1px solid #ddd;
  overflow: hidden;
  margin-top: 10px;
}

.left,
.right {
  width: 180px;
  background: #fafafa;
}

.middle {
  flex: 1;
  overflow-x: auto;
}

.scroll {
  display: inline-block;
  min-width: 100%;
}

.row {
  display: flex;
  width: 100%;
}

.month {
  flex: 1;
  /* üî• ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ç‡∏¢‡∏≤‡∏¢‡πÄ‡∏ï‡πá‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà */
  min-width: 32px;
  /* ‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡πá‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ */
  height: 36px;
  border-right: 1px solid #eee;
  border-bottom: 1px solid #eee;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

.month.active {
  background: #222;
}

.cell,
.header {
  padding: 8px;
  border-bottom: 1px solid #eee;
  height: 36px;
  display: flex;
  align-items: center;
}

.header {
  font-weight: bold;
  background: #f2f2f2;
}

.input {
  width: 100%;
  padding: 6px;
  border: 1px solid #ccc;
  border-radius: 4px;
}

.month input {
  pointer-events: none;
  /* ‡πÉ‡∏´‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏ä‡πà‡∏≠‡∏á */
  width: 14px;
  height: 14px;
}

.duration button {
  margin-right: 6px;
  padding: 6px 10px;
  border: 1px solid #333;
  background: white;
  cursor: pointer;
}

.duration button:hover {
  background: #eee;
}

.add {
  margin-top: 10px;
  padding: 8px 12px;
  background: #222;
  color: white;
  border: none;
  cursor: pointer;
}
</style>
